import{p as e,a,r as t,b as l,o,c as s,d,F as n,e as r,f as u,t as c,w as i,g as p,M as C,h as g,i as m,v,j as f,k as b,l as h,m as y,n as _,q as w,s as S,A as N,_ as Y}from"./vendor.196caadd.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(t){const l=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((t,s)=>{const d=new URL(e,l);if(self[a].moduleMap[d])return t(self[a].moduleMap[d]);const n=new Blob([`import * as m from '${d}';`,`${a}.moduleMap['${d}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){s(new Error(`Failed to import: ${e}`)),o(r)},onload(){t(self[a].moduleMap[d]),o(r)}});document.head.appendChild(r)})),self[a].moduleMap={}}}("/assets/");const E=ajaxurl;async function k(e){const a=new FormData;a.append("categoryId",e);const t=await fetch(E+"?action=ml_get_products_by_category_array",{method:"POST",body:a});return(await t.json()).map((e=>({id:e.product_id.toString(),title:e.product_name})))}const P={name:"CoursesSelect",props:["selectedCourses","allCourses"],emits:["change"],setup(e,{emit:a}){const l=t(!1),o=t(!1);return{isIndeterminate:o,checkAll:l,handleCheckAllChange:t=>{a("change",t?e.allCourses.map((e=>e.id)):[]),o.value=!1},handleCheckCourse:t=>{a("change",t);let s=t.length;l.value=s===e.allCourses.length,o.value=s>0&&s<e.allCourses.length}}}},U=i("data-v-1c46ba40");e("data-v-1c46ba40");const D=u(" Выбрать все ");a();const I=U(((e,a,t,i,p,C)=>{const g=l("ElCheckbox"),m=l("ElCheckboxGroup");return o(),s(n,null,[d(g,{indeterminate:i.isIndeterminate,modelValue:i.checkAll,"onUpdate:modelValue":a[1]||(a[1]=e=>i.checkAll=e),onChange:i.handleCheckAllChange},{default:U((()=>[D])),_:1},8,["indeterminate","modelValue","onChange"]),d(m,{"model-value":t.selectedCourses,onChange:i.handleCheckCourse},{default:U((()=>[(o(!0),s(n,null,r(t.allCourses,(e=>(o(),s("div",{key:e.id},[d(g,{label:e.id},{default:U((()=>[u(c(e.title),1)])),_:2},1032,["label"])])))),128))])),_:1},8,["model-value","onChange"])],64)}));P.render=I,P.__scopeId="data-v-1c46ba40";const $={name:"CoursesControl",components:{CoursesSelect:P},props:{selectedCourses:Array,allCourses:Array,loading:Boolean},emits:["update:selectedCourses"],setup(e){let a=t(null),l=t(null);return p((()=>{e.loading&&(l.value=C.service({target:a.value,spinner:"el-icon-loading",fullscreen:!1}))})),g((()=>{if(e.loading)a.value&&(l.value=C.service({target:a.value,spinner:"el-icon-loading",fullscreen:!1}));else{if(!l.value)return;l.value.close()}})),{dom:a}}},j=i("data-v-bfb89828");e("data-v-bfb89828");const x={ref:"dom",class:"e-loading"};a();const O=j(((e,a,t,n,r,u)=>{const c=l("CoursesSelect"),i=l("ElCard"),p=l("ElCollapseItem"),C=l("ElCollapse");return o(),s("div",x,[m(d(C,{"model-value":"1"},{default:j((()=>[d(p,{title:"Скрыть выбор курсов",name:"1"},{default:j((()=>[d(i,{class:"card"},{default:j((()=>[d(c,{allCourses:t.allCourses,selectedCourses:t.selectedCourses,onChange:a[1]||(a[1]=a=>e.$emit("update:selectedCourses",a))},null,8,["allCourses","selectedCourses"])])),_:1}),f(e.$slots,"date")])),_:3})])),_:1},512),[[v,0!==t.allCourses.length]])],512)}));$.render=O,$.__scopeId="data-v-bfb89828";const T=i("data-v-d06cc744");e("data-v-d06cc744");const F=u("Выбрать все"),M=u("Курс 1"),A=u("Курс 2"),L=u("Курс 3"),R=u("Курс 4"),V=u("Курс 5");a();const B={expose:[],setup:e=>T(((e,a)=>{const t=l("ElOption"),u=l("ElSelect"),c=l("ElCheckbox"),i=l("ElCard"),p=l("ElCollapseItem"),C=l("ElCollapse");return o(),s(n,null,[d(u,{modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=a=>e.value=a),placeholder:"Выбрать категорию",class:"select"},{default:T((()=>[(o(!0),s(n,null,r(e.options,(e=>(o(),s(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),d(C,{"model-value":"0"},{default:T((()=>[d(p,{title:"Скрыть выбор курсов",name:"1"},{default:T((()=>[d(i,{class:"card"},{default:T((()=>[d("div",null,[d(c,null,{default:T((()=>[F])),_:1})]),d("div",null,[d(c,null,{default:T((()=>[M])),_:1})]),d("div",null,[d(c,null,{default:T((()=>[A])),_:1})]),d("div",null,[d(c,null,{default:T((()=>[L])),_:1})]),d("div",null,[d(c,null,{default:T((()=>[R])),_:1})]),d("div",null,[d(c,null,{default:T((()=>[V])),_:1})])])),_:1})])),_:1})])),_:1})],64)})),__scopeId:"data-v-d06cc744"};const J={name:"DateSelect",props:["date","datePeriod"],emits:["update:date","update:datePeriod"]},q=i("data-v-bd6e94e8");e("data-v-bd6e94e8");const G={class:"radio"},z=u("До выбранной даты"),H={class:"radio"},K=u("После выбранной даты"),Q={class:"date"};a();const W=q(((e,a,t,r,u,c)=>{const i=l("ElRadio"),p=l("el-radio-group"),C=l("ElDatePicker");return o(),s(n,null,[d("div",null,[d(p,{"model-value":t.datePeriod,onChange:a[1]||(a[1]=a=>e.$emit("update:datePeriod",a))},{default:q((()=>[d("div",G,[d(i,{label:"before"},{default:q((()=>[z])),_:1})]),d("div",H,[d(i,{label:"after"},{default:q((()=>[K])),_:1})])])),_:1},8,["model-value"])]),d("div",Q,[d(C,{format:"YYYY-MM-DD","model-value":t.date,onChange:a[2]||(a[2]=a=>e.$emit("update:date",a))},null,8,["model-value"])])],64)}));J.render=W,J.__scopeId="data-v-bd6e94e8";const X={name:"CategorySelect",props:["allCategories","selectedCategory"]},Z=i("data-v-5978d282"),ee=Z(((e,a,t,d,u,c)=>{const i=l("ElOption"),p=l("ElSelect");return o(),s(p,{"model-value":t.selectedCategory,onChange:a[1]||(a[1]=a=>e.$emit("change",a)),placeholder:"Выбрать категорию",class:"select"},{default:Z((()=>[(o(!0),s(n,null,r(t.allCategories,(e=>(o(),s(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["model-value"])}));X.render=ee,X.__scopeId="data-v-5978d282";const ae={name:"CoursesFilter",components:{DateSelect:J,CoursesNo:B,CoursesControl:$,CategorySelect:X},props:["selectedCoursesYes","categoryYes","selectedCoursesNo","categoryNo","date","datePeriod"],emits:["update:selectedCoursesYes","update:categoryYes","update:selectedCoursesNo","update:categoryNo","change","update:date","update:datePeriod"],setup:function(e,{emit:a}){let l=t([]),o=t([]),s=t([]),d=t(!1),n=t(!1);return p((async()=>{l.value=await async function(){const e=await fetch(E+"?action=ml_get_product_category");return(await e.json()).map((e=>({value:e.id.toString(),label:e.name})))}()})),b((()=>e.categoryYes),((e,t)=>{a("update:selectedCoursesYes",[]),(async e=>{d.value=!0,o.value=await k(e),d.value=!1,a("change")})(e)})),b((()=>e.categoryNo),((e,t)=>{a("update:selectedCoursesNo",[]),(async e=>{n.value=!0,s.value=await k(e),n.value=!1,a("change")})(e)})),{allCategories:l,allCoursesYes:o,allCoursesNo:s,loadingCoursesYes:d,loadingCoursesNo:n}}},te=i("data-v-21d48484"),le=te(((e,a,t,n,r,u)=>{const c=l("CategorySelect"),i=l("DateSelect"),p=l("CoursesControl"),C=l("ElCol"),g=l("ElRow");return o(),s(g,{gutter:30},{default:te((()=>[d(C,{span:12},{default:te((()=>[d(c,{allCategories:e.allCategories,selectedCategory:t.categoryYes,onChange:a[1]||(a[1]=a=>e.$emit("update:categoryYes",a))},null,8,["allCategories","selectedCategory"]),d(p,{selectedCourses:t.selectedCoursesYes,"onUpdate:selectedCourses":[a[4]||(a[4]=e=>t.selectedCoursesYes=e),a[5]||(a[5]=a=>e.$emit("update:selectedCoursesYes",a))],allCourses:e.allCoursesYes,loading:e.loadingCoursesYes},{date:te((()=>[d(i,{date:t.date,"onUpdate:date":a[2]||(a[2]=a=>e.$emit("update:date",a)),datePeriod:t.datePeriod,"onUpdate:datePeriod":a[3]||(a[3]=a=>e.$emit("update:datePeriod",a))},null,8,["date","datePeriod"])])),_:1},8,["selectedCourses","allCourses","loading"])])),_:1}),d(C,{span:12},{default:te((()=>[d(c,{allCategories:e.allCategories,selectedCategory:t.categoryNo,onChange:a[6]||(a[6]=a=>e.$emit("update:categoryNo",a))},null,8,["allCategories","selectedCategory"]),d(p,{selectedCourses:t.selectedCoursesNo,"onUpdate:selectedCourses":[a[7]||(a[7]=e=>t.selectedCoursesNo=e),a[8]||(a[8]=a=>e.$emit("update:selectedCoursesNo",a))],allCourses:e.allCoursesNo,loading:e.loadingCoursesNo},null,8,["selectedCourses","allCourses","loading"])])),_:1})])),_:1})}));ae.render=le,ae.__scopeId="data-v-21d48484";const oe={name:"TableExport",emits:["click"],props:["count"]},se=i("data-v-45e401b6");e("data-v-45e401b6");const de={class:"btn-import"},ne={key:0},re={class:"wrap"},ue=u("Экспорт");a();const ce=se(((e,a,t,n,r,u)=>{const i=l("ElButton");return o(),s("div",de,[d("div",null,[0!==t.count?(o(),s("span",ne,"Всего: "+c(t.count),1)):h("",!0)]),d("div",re,[d(i,{onClick:a[1]||(a[1]=a=>e.$emit("click")),type:"primary",icon:"el-icon-download"},{default:se((()=>[ue])),_:1})])])}));oe.render=ce,oe.__scopeId="data-v-45e401b6";const ie={props:["loading","tableData","multipleSelection"],emits:["update:multipleSelection"],setup:(e,{emit:a})=>({multipleTable:t(null),handleSelectionChange:function(e){a("update:multipleSelection",e)}})},pe=i("data-v-019c1ddc"),Ce=pe(((e,a,t,n,r,i)=>{const p=l("ElTableColumn"),C=l("ElLink"),g=l("ElTable"),v=y("loading");return m((o(),s(g,{border:"",ref:"multipleTable",data:t.tableData,style:{width:"100%"},onSelectionChange:n.handleSelectionChange},{default:pe((()=>[d(p,{type:"selection",width:"55"}),d(p,{label:"ID",property:"ID",width:"90"}),d(p,{label:"Логин"},{default:pe((e=>[d(C,{target:"_blank",href:e.row.userLink},{default:pe((()=>[u(c(e.row.userName),1)])),_:2},1032,["href"])])),_:1}),d(p,{property:"lastName",label:"Фамилия","show-overflow-tooltip":""}),d(p,{property:"firstName",label:"Имя","show-overflow-tooltip":""}),d(p,{property:"surname",label:"Отчество","show-overflow-tooltip":""}),d(p,{property:"email",label:"Email","show-overflow-tooltip":""})])),_:1},8,["data","onSelectionChange"])),[[v,t.loading]])}));ie.render=Ce,ie.__scopeId="data-v-019c1ddc";const ge={components:{UsersTable:ie,TableExport:oe,CoursesFilter:ae},setup(){let e=t(!1),a=t([]),l=t([]),o=t(""),s=t(""),d=t([]),n=t(!1),r=t([]),u=t(""),c=t("before"),i=_((()=>d.value.length));b(e,(async t=>{t&&(n.value=!0,d.value=await async function(e,a,t=new Date,l="before"){const o=new FormData;if(o.append("yes",JSON.stringify(e)),o.append("no",JSON.stringify(a)),t){let e=t.getMonth()+1,a=t.getDate(),s=t.getFullYear()+"-"+(e>9?e.toString():"0"+e)+"-"+(a>9?a.toString():"0"+a.toString());o.append("date",s),o.append("datePeriod",l)}const s=await fetch(E+"?action=ml_get_filtered_users",{method:"POST",body:o});return(await s.json()).users}({catId:o.value,ids:Object.values(a.value)},{catId:s.value,ids:Object.values(l.value)},u.value,c.value),n.value=!1,e.value=!1)}));return{start:e,selectedCoursesYes:a,categoryYes:o,selectedCoursesNo:l,categoryNo:s,loading:n,tableData:d,multipleSelection:r,exportExcel:()=>{let e=Object.values(r.value).map((e=>e.ID));e.length?async function(e){const a=new FormData;a.append("userIds",e.join());const t=await fetch(E+"?action=ml_get_file",{method:"POST",body:a}),l=await t.text();window.open(l)}(e):window.alert("Выберите пользователей")},count:i,date:u,datePeriod:c,aaa:e=>console.log(e)}}},me={class:"container"},ve=u("Сделать выборку");ge.render=function(e,a,t,n,r,u){const c=l("CoursesFilter"),i=l("ElButton"),p=l("TableExport"),C=l("UsersTable");return o(),s("div",me,[d(c,{selectedCoursesYes:n.selectedCoursesYes,"onUpdate:selectedCoursesYes":a[1]||(a[1]=e=>n.selectedCoursesYes=e),selectedCoursesNo:n.selectedCoursesNo,"onUpdate:selectedCoursesNo":a[2]||(a[2]=e=>n.selectedCoursesNo=e),categoryYes:n.categoryYes,"onUpdate:categoryYes":a[3]||(a[3]=e=>n.categoryYes=e),categoryNo:n.categoryNo,"onUpdate:categoryNo":a[4]||(a[4]=e=>n.categoryNo=e),onChange:a[5]||(a[5]=e=>n.tableData=[]),date:n.date,"onUpdate:date":a[6]||(a[6]=e=>n.date=e),datePeriod:n.datePeriod,"onUpdate:datePeriod":[a[7]||(a[7]=e=>n.datePeriod=e),n.aaa]},null,8,["selectedCoursesYes","selectedCoursesNo","categoryYes","categoryNo","date","datePeriod","onUpdate:datePeriod"]),d(i,{type:"success",class:"start",onClick:a[8]||(a[8]=e=>n.start=!0)},{default:w((()=>[ve])),_:1}),d(p,{onClick:n.exportExcel,count:n.count},null,8,["onClick","count"]),d(C,{"table-data":n.tableData,loading:n.loading,multipleSelection:n.multipleSelection,"onUpdate:multipleSelection":a[9]||(a[9]=e=>n.multipleSelection=e)},null,8,["table-data","loading","multipleSelection"])])};const fe=S(ge);fe.use(N,{locale:Y}),fe.mount("#app");
