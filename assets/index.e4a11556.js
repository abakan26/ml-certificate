import{p as e,a,r as l,b as t,o,c as s,d,F as n,e as r,f as u,t as c,w as i,g as p,M as m,h as C,i as v,v as g,j as f,k as _,l as b,m as h,n as y,q as w,s as S,A as N,_ as Y}from"./vendor.196caadd.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(l){const t=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((l,s)=>{const d=new URL(e,t);if(self[a].moduleMap[d])return l(self[a].moduleMap[d]);const n=new Blob([`import * as m from '${d}';`,`${a}.moduleMap['${d}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){s(new Error(`Failed to import: ${e}`)),o(r)},onload(){l(self[a].moduleMap[d]),o(r)}});document.head.appendChild(r)})),self[a].moduleMap={}}}("/assets/");const E=ajaxurl;async function k(e){const a=new FormData;a.append("categoryId",e);const l=await fetch(E+"?action=ml_get_products_by_category_array",{method:"POST",body:a});return(await l.json()).map((e=>({id:e.product_id.toString(),title:e.product_name})))}const L={name:"CoursesSelect",props:["selectedCourses","allCourses"],emits:["change"],setup(e,{emit:a}){const t=l(!1),o=l(!1);return{isIndeterminate:o,checkAll:t,handleCheckAllChange:l=>{a("change",l?e.allCourses.map((e=>e.id)):[]),o.value=!1},handleCheckCourse:l=>{a("change",l);let s=l.length;t.value=s===e.allCourses.length,o.value=s>0&&s<e.allCourses.length}}}},P=i("data-v-1c46ba40");e("data-v-1c46ba40");const U=u(" Выбрать все ");a();const D=P(((e,a,l,i,p,m)=>{const C=t("ElCheckbox"),v=t("ElCheckboxGroup");return o(),s(n,null,[d(C,{indeterminate:i.isIndeterminate,modelValue:i.checkAll,"onUpdate:modelValue":a[1]||(a[1]=e=>i.checkAll=e),onChange:i.handleCheckAllChange},{default:P((()=>[U])),_:1},8,["indeterminate","modelValue","onChange"]),d(v,{"model-value":l.selectedCourses,onChange:i.handleCheckCourse},{default:P((()=>[(o(!0),s(n,null,r(l.allCourses,(e=>(o(),s("div",{key:e.id},[d(C,{label:e.id},{default:P((()=>[u(c(e.title),1)])),_:2},1032,["label"])])))),128))])),_:1},8,["model-value","onChange"])],64)}));L.render=D,L.__scopeId="data-v-1c46ba40";const I={name:"CoursesControl",components:{CoursesSelect:L},props:{selectedCourses:Array,allCourses:Array,loading:Boolean},emits:["update:selectedCourses"],setup(e){let a=l(null),t=l(null);return p((()=>{e.loading&&(t.value=m.service({target:a.value,spinner:"el-icon-loading",fullscreen:!1}))})),C((()=>{if(e.loading)a.value&&(t.value=m.service({target:a.value,spinner:"el-icon-loading",fullscreen:!1}));else{if(!t.value)return;t.value.close()}})),{dom:a}}},$=i("data-v-bfb89828");e("data-v-bfb89828");const x={ref:"dom",class:"e-loading"};a();const j=$(((e,a,l,n,r,u)=>{const c=t("CoursesSelect"),i=t("ElCard"),p=t("ElCollapseItem"),m=t("ElCollapse");return o(),s("div",x,[v(d(m,{"model-value":"1"},{default:$((()=>[d(p,{title:"Скрыть выбор курсов",name:"1"},{default:$((()=>[d(i,{class:"card"},{default:$((()=>[d(c,{allCourses:l.allCourses,selectedCourses:l.selectedCourses,onChange:a[1]||(a[1]=a=>e.$emit("update:selectedCourses",a))},null,8,["allCourses","selectedCourses"])])),_:1}),f(e.$slots,"date")])),_:3})])),_:1},512),[[g,0!==l.allCourses.length]])],512)}));I.render=j,I.__scopeId="data-v-bfb89828";const O=i("data-v-d06cc744");e("data-v-d06cc744");const T=u("Выбрать все"),F=u("Курс 1"),M=u("Курс 2"),A=u("Курс 3"),R=u("Курс 4"),V=u("Курс 5");a();const B={expose:[],setup:e=>O(((e,a)=>{const l=t("ElOption"),u=t("ElSelect"),c=t("ElCheckbox"),i=t("ElCard"),p=t("ElCollapseItem"),m=t("ElCollapse");return o(),s(n,null,[d(u,{modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=a=>e.value=a),placeholder:"Выбрать категорию",class:"select"},{default:O((()=>[(o(!0),s(n,null,r(e.options,(e=>(o(),s(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),d(m,{"model-value":"0"},{default:O((()=>[d(p,{title:"Скрыть выбор курсов",name:"1"},{default:O((()=>[d(i,{class:"card"},{default:O((()=>[d("div",null,[d(c,null,{default:O((()=>[T])),_:1})]),d("div",null,[d(c,null,{default:O((()=>[F])),_:1})]),d("div",null,[d(c,null,{default:O((()=>[M])),_:1})]),d("div",null,[d(c,null,{default:O((()=>[A])),_:1})]),d("div",null,[d(c,null,{default:O((()=>[R])),_:1})]),d("div",null,[d(c,null,{default:O((()=>[V])),_:1})])])),_:1})])),_:1})])),_:1})],64)})),__scopeId:"data-v-d06cc744"};const J={name:"DateSelect",props:["date","datePeriod","wpmLevel"],emits:["update:date","update:datePeriod","update:wpmLevel"]},q=i("data-v-ef3b9708");e("data-v-ef3b9708");const G={class:"radio"},z=u("До выбранной даты"),H={class:"radio"},K=u("После выбранной даты"),Q={class:"radio"},W=u("Дата начала доступа"),X={class:"radio"},Z=u("Дата окончания доступа "),ee={class:"date"};a();const ae=q(((e,a,l,r,u,c)=>{const i=t("ElRadio"),p=t("el-radio-group"),m=t("ElDatePicker");return o(),s(n,null,[d("div",null,[d(p,{"model-value":l.datePeriod,onChange:a[1]||(a[1]=a=>e.$emit("update:datePeriod",a))},{default:q((()=>[d("div",G,[d(i,{label:"before"},{default:q((()=>[z])),_:1})]),d("div",H,[d(i,{label:"after"},{default:q((()=>[K])),_:1})])])),_:1},8,["model-value"]),d(p,{style:{"margin-left":"15px"},"model-value":l.wpmLevel,onChange:a[2]||(a[2]=a=>e.$emit("update:wpmLevel",a))},{default:q((()=>[d("div",Q,[d(i,{label:"date_start"},{default:q((()=>[W])),_:1})]),d("div",X,[d(i,{label:"date_end"},{default:q((()=>[Z])),_:1})])])),_:1},8,["model-value"])]),d("div",ee,[d(m,{format:"YYYY-MM-DD","model-value":l.date,onChange:a[3]||(a[3]=a=>e.$emit("update:date",a))},null,8,["model-value"])])],64)}));J.render=ae,J.__scopeId="data-v-ef3b9708";const le={name:"CategorySelect",props:["allCategories","selectedCategory"]},te=i("data-v-5978d282"),oe=te(((e,a,l,d,u,c)=>{const i=t("ElOption"),p=t("ElSelect");return o(),s(p,{"model-value":l.selectedCategory,onChange:a[1]||(a[1]=a=>e.$emit("change",a)),placeholder:"Выбрать категорию",class:"select"},{default:te((()=>[(o(!0),s(n,null,r(l.allCategories,(e=>(o(),s(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["model-value"])}));le.render=oe,le.__scopeId="data-v-5978d282";const se={name:"CoursesFilter",components:{DateSelect:J,CoursesNo:B,CoursesControl:I,CategorySelect:le},props:["selectedCoursesYes","categoryYes","selectedCoursesNo","categoryNo","date","datePeriod","wpmLevel"],emits:["update:selectedCoursesYes","update:categoryYes","update:selectedCoursesNo","update:categoryNo","change","update:date","update:datePeriod","update:wpmLevel"],setup:function(e,{emit:a}){let t=l([]),o=l([]),s=l([]),d=l(!1),n=l(!1);return p((async()=>{t.value=await async function(){const e=await fetch(E+"?action=ml_get_product_category");return(await e.json()).map((e=>({value:e.id.toString(),label:e.name})))}()})),_((()=>e.categoryYes),((e,l)=>{a("update:selectedCoursesYes",[]),(async e=>{d.value=!0,o.value=await k(e),d.value=!1,a("change")})(e)})),_((()=>e.categoryNo),((e,l)=>{a("update:selectedCoursesNo",[]),(async e=>{n.value=!0,s.value=await k(e),n.value=!1,a("change")})(e)})),{allCategories:t,allCoursesYes:o,allCoursesNo:s,loadingCoursesYes:d,loadingCoursesNo:n}}},de=i("data-v-17532e06"),ne=de(((e,a,l,n,r,u)=>{const c=t("CategorySelect"),i=t("DateSelect"),p=t("CoursesControl"),m=t("ElCol"),C=t("ElRow");return o(),s(C,{gutter:30},{default:de((()=>[d(m,{span:12},{default:de((()=>[d(c,{allCategories:e.allCategories,selectedCategory:l.categoryYes,onChange:a[1]||(a[1]=a=>e.$emit("update:categoryYes",a))},null,8,["allCategories","selectedCategory"]),d(p,{selectedCourses:l.selectedCoursesYes,"onUpdate:selectedCourses":[a[5]||(a[5]=e=>l.selectedCoursesYes=e),a[6]||(a[6]=a=>e.$emit("update:selectedCoursesYes",a))],allCourses:e.allCoursesYes,loading:e.loadingCoursesYes},{date:de((()=>[d(i,{date:l.date,"onUpdate:date":a[2]||(a[2]=a=>e.$emit("update:date",a)),datePeriod:l.datePeriod,"onUpdate:datePeriod":a[3]||(a[3]=a=>e.$emit("update:datePeriod",a)),wpmLevel:l.wpmLevel,"onUpdate:wpmLevel":a[4]||(a[4]=a=>e.$emit("update:wpmLevel",a))},null,8,["date","datePeriod","wpmLevel"])])),_:1},8,["selectedCourses","allCourses","loading"])])),_:1}),d(m,{span:12},{default:de((()=>[d(c,{allCategories:e.allCategories,selectedCategory:l.categoryNo,onChange:a[7]||(a[7]=a=>e.$emit("update:categoryNo",a))},null,8,["allCategories","selectedCategory"]),d(p,{selectedCourses:l.selectedCoursesNo,"onUpdate:selectedCourses":[a[8]||(a[8]=e=>l.selectedCoursesNo=e),a[9]||(a[9]=a=>e.$emit("update:selectedCoursesNo",a))],allCourses:e.allCoursesNo,loading:e.loadingCoursesNo},null,8,["selectedCourses","allCourses","loading"])])),_:1})])),_:1})}));se.render=ne,se.__scopeId="data-v-17532e06";const re={name:"TableExport",emits:["click"],props:["count"]},ue=i("data-v-45e401b6");e("data-v-45e401b6");const ce={class:"btn-import"},ie={key:0},pe={class:"wrap"},me=u("Экспорт");a();const Ce=ue(((e,a,l,n,r,u)=>{const i=t("ElButton");return o(),s("div",ce,[d("div",null,[0!==l.count?(o(),s("span",ie,"Всего: "+c(l.count),1)):b("",!0)]),d("div",pe,[d(i,{onClick:a[1]||(a[1]=a=>e.$emit("click")),type:"primary",icon:"el-icon-download"},{default:ue((()=>[me])),_:1})])])}));re.render=Ce,re.__scopeId="data-v-45e401b6";const ve={props:["loading","tableData","multipleSelection"],emits:["update:multipleSelection"],setup:(e,{emit:a})=>({multipleTable:l(null),handleSelectionChange:function(e){a("update:multipleSelection",e)}})},ge=i("data-v-019c1ddc"),fe=ge(((e,a,l,n,r,i)=>{const p=t("ElTableColumn"),m=t("ElLink"),C=t("ElTable"),g=h("loading");return v((o(),s(C,{border:"",ref:"multipleTable",data:l.tableData,style:{width:"100%"},onSelectionChange:n.handleSelectionChange},{default:ge((()=>[d(p,{type:"selection",width:"55"}),d(p,{label:"ID",property:"ID",width:"90"}),d(p,{label:"Логин"},{default:ge((e=>[d(m,{target:"_blank",href:e.row.userLink},{default:ge((()=>[u(c(e.row.userName),1)])),_:2},1032,["href"])])),_:1}),d(p,{property:"lastName",label:"Фамилия","show-overflow-tooltip":""}),d(p,{property:"firstName",label:"Имя","show-overflow-tooltip":""}),d(p,{property:"surname",label:"Отчество","show-overflow-tooltip":""}),d(p,{property:"email",label:"Email","show-overflow-tooltip":""})])),_:1},8,["data","onSelectionChange"])),[[g,l.loading]])}));ve.render=fe,ve.__scopeId="data-v-019c1ddc";const _e={components:{UsersTable:ve,TableExport:re,CoursesFilter:se},setup(){let e=l(!1),a=l([]),t=l([]),o=l(""),s=l(""),d=l([]),n=l(!1),r=l([]),u=l(""),c=l("before"),i=l("date_start"),p=y((()=>d.value.length));_(e,(async l=>{l&&(n.value=!0,d.value=await async function(e,a,l=new Date,t="before",o="start"){const s=new FormData;if(s.append("yes",JSON.stringify(e)),s.append("no",JSON.stringify(a)),l){let e=l.getMonth()+1,a=l.getDate(),d=l.getFullYear()+"-"+(e>9?e.toString():"0"+e)+"-"+(a>9?a.toString():"0"+a.toString());s.append("date",d),s.append("datePeriod",t),s.append("wpmLevel",o)}const d=await fetch(E+"?action=ml_get_filtered_users",{method:"POST",body:s});return(await d.json()).users}({catId:o.value,ids:Object.values(a.value)},{catId:s.value,ids:Object.values(t.value)},u.value,c.value,i.value),n.value=!1,e.value=!1)}));return{start:e,selectedCoursesYes:a,categoryYes:o,selectedCoursesNo:t,categoryNo:s,loading:n,tableData:d,multipleSelection:r,exportExcel:()=>{let e=Object.values(r.value).map((e=>e.ID));e.length?async function(e){const a=new FormData;a.append("userIds",e.join());const l=await fetch(E+"?action=ml_get_file",{method:"POST",body:a}),t=await l.text();window.open(t)}(e):window.alert("Выберите пользователей")},count:p,date:u,datePeriod:c,aaa:e=>console.log(e),wpmLevel:i}}},be={class:"container"},he=u("Сделать выборку");_e.render=function(e,a,l,n,r,u){const c=t("CoursesFilter"),i=t("ElButton"),p=t("TableExport"),m=t("UsersTable");return o(),s("div",be,[d(c,{selectedCoursesYes:n.selectedCoursesYes,"onUpdate:selectedCoursesYes":a[1]||(a[1]=e=>n.selectedCoursesYes=e),selectedCoursesNo:n.selectedCoursesNo,"onUpdate:selectedCoursesNo":a[2]||(a[2]=e=>n.selectedCoursesNo=e),categoryYes:n.categoryYes,"onUpdate:categoryYes":a[3]||(a[3]=e=>n.categoryYes=e),categoryNo:n.categoryNo,"onUpdate:categoryNo":a[4]||(a[4]=e=>n.categoryNo=e),onChange:a[5]||(a[5]=e=>n.tableData=[]),date:n.date,"onUpdate:date":a[6]||(a[6]=e=>n.date=e),datePeriod:n.datePeriod,"onUpdate:datePeriod":[a[7]||(a[7]=e=>n.datePeriod=e),n.aaa],wpmLevel:n.wpmLevel,"onUpdate:wpmLevel":a[8]||(a[8]=e=>n.wpmLevel=e)},null,8,["selectedCoursesYes","selectedCoursesNo","categoryYes","categoryNo","date","datePeriod","onUpdate:datePeriod","wpmLevel"]),d(i,{type:"success",class:"start",onClick:a[9]||(a[9]=e=>n.start=!0)},{default:w((()=>[he])),_:1}),d(p,{onClick:n.exportExcel,count:n.count},null,8,["onClick","count"]),d(m,{"table-data":n.tableData,loading:n.loading,multipleSelection:n.multipleSelection,"onUpdate:multipleSelection":a[10]||(a[10]=e=>n.multipleSelection=e)},null,8,["table-data","loading","multipleSelection"])])};const ye=S(_e);ye.use(N,{locale:Y}),ye.mount("#app");
